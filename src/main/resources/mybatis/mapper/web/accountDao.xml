<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lattory.lattoryLotoBackEnd.web.dao.AccountDao">

    <select id="inquirySubAccount" resultType="JsonObject">
        <![CDATA[
            SELECT
                acc."id"
                , acc.account_name      as "accountName"
                , acc.account_id        as "accountID"
                , acc.account_type      as "accountType"
                , acc.account_balance   as "accountBalance"
                , acc.account_currency   as "currency"
                ,acc.account_status     as "status"
            from account_details as acdt
            INNER JOIN account as acc on acc."id" = acdt.sub_account_id
			WHERE acdt.main_account_id = #{mainAccountID}
            ORDER BY acc."id" ASC;
	     ]]>
    </select>

    <select id="inquiryAccountByUserID" resultType="JsonObject">
        <![CDATA[
            SELECT
                acc."id"
                , acc.account_name      as "accountName"
                , acc.account_id        as "accountID"
                , acc.account_type      as "accountType"
                , acc.account_balance   as "accountBalance"
                , acc.account_status    as "status"
                , acc.account_currency   as "currency"
            FROM account as acc
            WHERE acc.user_id = #{userID};
	     ]]>
    </select>

    <insert id="save">
        <![CDATA[
            INSERT INTO account
            (
                id
                , account_name
                , account_id
                , account_type
                , account_balance
                , account_status
                , create_by
                , create_at
                , user_id
                , account_currency
            ) VALUES (
                #{id}
                , #{accountName}
                , #{accountID}
                , #{accountType}
                , #{accountBalance}
                , #{accountStatus}
                , #{createBy}
                , to_char(NOW(), 'YYYYMMDD')
                , #{userID}
                , #{currency}
            )
    	]]>
    </insert>


    <select id="count" resultType="java.lang.Integer">
        <![CDATA[
		  SELECT
	     	COUNT (*)
	      FROM "account"
	     ]]>
    </select>

    <select id="maxAccountID" resultType="java.lang.Integer">
        <![CDATA[
		  SELECT MAX(account_id)
        FROM account
        WHERE account_id != '999999999';
	     ]]>
    </select>

    <update id="updateAccountName">
        <![CDATA[
            UPDATE account
			SET
			    account_name      = #{accountName}
			WHERE id 	= #{id} and account_id = #{accountID}
    	]]>
    </update>

</mapper>